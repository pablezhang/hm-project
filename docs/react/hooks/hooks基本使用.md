## Hooksæ˜¯ä»€ä¹ˆï¼Ÿ 

**ç›®æ ‡**ï¼šèƒ½å¤Ÿè¯´å‡º React Hooksæ˜¯ä»€ä¹ˆï¼Ÿ

**å†…å®¹**ï¼š

- `Hooks`ï¼šé’©å­ã€é’“é’©ã€é’©ä½
- `Hooks` æ˜¯ **React v16.8** ä¸­çš„æ–°å¢åŠŸèƒ½ 
- ä½œç”¨ï¼šä¸º**å‡½æ•°ç»„ä»¶**æä¾›çŠ¶æ€ã€ç”Ÿå‘½å‘¨æœŸç­‰åŸæœ¬ class ç»„ä»¶ä¸­æä¾›çš„ React åŠŸèƒ½
  - å¯ä»¥ç†è§£ä¸ºé€šè¿‡ Hooks ä¸ºå‡½æ•°ç»„ä»¶é’©å…¥ class ç»„ä»¶çš„ç‰¹æ€§
- æ³¨æ„ï¼š<span style="color:red">**Hooks åªèƒ½åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨**</span>ï¼Œè‡ªæ­¤ï¼Œå‡½æ•°ç»„ä»¶æˆä¸º React çš„æ–°å® å„¿

React v16.8 ç‰ˆæœ¬å‰åï¼Œç»„ä»¶å¼€å‘æ¨¡å¼çš„å¯¹æ¯”ï¼š

- React v16.8 ä»¥å‰ï¼š class ç»„ä»¶(æä¾›çŠ¶æ€) + å‡½æ•°ç»„ä»¶(å±•ç¤ºå†…å®¹)
- React v16.8 åŠå…¶ä»¥åï¼š
  1. class ç»„ä»¶(æä¾›çŠ¶æ€) + å‡½æ•°ç»„ä»¶(å±•ç¤ºå†…å®¹)
  2. Hooks(æä¾›çŠ¶æ€) + å‡½æ•°ç»„ä»¶(å±•ç¤ºå†…å®¹)
  3. æ··ç”¨ä»¥ä¸Šä¸¤ç§æ–¹å¼ï¼šéƒ¨åˆ†åŠŸèƒ½ç”¨ class ç»„ä»¶ï¼Œéƒ¨åˆ†åŠŸèƒ½ç”¨ Hooks+å‡½æ•°ç»„ä»¶

**æ€»ç»“**ï¼š

æ³¨æ„1ï¼šè™½ç„¶æœ‰äº† Hooksï¼Œä½† *React å®˜æ–¹å¹¶æ²¡æœ‰è®¡åˆ’ä» React åº“ä¸­ç§»é™¤ class*

æ³¨æ„2ï¼šæœ‰äº† Hooks ä»¥åï¼Œä¸èƒ½å†æŠŠ**å‡½æ•°ç»„ä»¶**ç§°ä¸º~~æ— çŠ¶æ€ç»„ä»¶~~äº†ï¼Œå› ä¸º Hooks ä¸ºå‡½æ•°ç»„ä»¶æä¾›äº†çŠ¶æ€











## ä¸ºä»€ä¹ˆè¦æœ‰ Hooks  

**ç›®æ ‡**ï¼šèƒ½å¤Ÿè¯´å‡ºä¸ºä»€ä¹ˆè¦æœ‰ Hooks ä»¥åŠ Hooks èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜

**å†…å®¹**ï¼š

ä¸¤ä¸ªè§’åº¦ï¼š1 ç»„ä»¶çš„çŠ¶æ€é€»è¾‘å¤ç”¨  2 class ç»„ä»¶è‡ªèº«çš„é—®é¢˜

1. ç»„ä»¶çš„çŠ¶æ€é€»è¾‘å¤ç”¨ï¼š
   + åœ¨ Hooks ä¹‹å‰ï¼Œç»„ä»¶çš„çŠ¶æ€é€»è¾‘å¤ç”¨ç»å†äº†ï¼šmixinsï¼ˆæ··å…¥ï¼‰ã€HOCsï¼ˆé«˜é˜¶ç»„ä»¶ï¼‰ã€render-props ç­‰æ¨¡å¼
   + ï¼ˆæ—©å·²åºŸå¼ƒï¼‰mixins çš„é—®é¢˜ï¼š1 æ•°æ®æ¥æºä¸æ¸…æ™° 2 å‘½åå†²çª
   + HOCsã€render-props çš„é—®é¢˜ï¼šé‡æ„ç»„ä»¶ç»“æ„ï¼Œå¯¼è‡´ç»„ä»¶å½¢æˆ JSX åµŒå¥—åœ°ç‹±é—®é¢˜

2. class ç»„ä»¶è‡ªèº«çš„é—®é¢˜ï¼š
   + é€‰æ‹©ï¼šå‡½æ•°ç»„ä»¶å’Œ class ç»„ä»¶ä¹‹é—´çš„åŒºåˆ«ä»¥åŠä½¿ç”¨å“ªç§ç»„ä»¶æ›´åˆé€‚
   + éœ€è¦ç†è§£ class ä¸­çš„ this æ˜¯å¦‚ä½•å·¥ä½œçš„
   + ç›¸äº’å…³è”ä¸”éœ€è¦å¯¹ç…§ä¿®æ”¹çš„ä»£ç è¢«æ‹†åˆ†åˆ°ä¸åŒç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­

- ç›¸æ¯”äºå‡½æ•°ç»„ä»¶æ¥è¯´ï¼Œä¸åˆ©äºä»£ç å‹ç¼©å’Œä¼˜åŒ–ï¼Œä¹Ÿä¸åˆ©äº TS çš„ç±»å‹æ¨å¯¼

**æ€»ç»“**ï¼š

æ­£æ˜¯ç”±äº React åŸæ¥å­˜åœ¨çš„è¿™äº›é—®é¢˜ï¼Œæ‰æœ‰äº† Hooks æ¥è§£å†³è¿™äº›é—®é¢˜









### å‰é¢å­¦ä¹ çš„ React çŸ¥è¯†æ˜¯æœ‰ç”¨çš„

class ç»„ä»¶ç›¸å…³çš„ API ä¸ç”¨äº†ï¼Œæ¯”å¦‚ï¼š

- `class Hello extends Component`
- `componentDidMount`ã€`componentDidUpdate`ã€`componentWillUnmount`
- `this` ç›¸å…³çš„ç”¨æ³•

åŸæ¥å­¦ä¹ çš„å†…å®¹è¿˜æ˜¯è¦ç”¨çš„ï¼Œæ¯”å¦‚ï¼š

- JSXï¼š`{}`ã€`onClick={handleClick}`ã€æ¡ä»¶æ¸²æŸ“ã€åˆ—è¡¨æ¸²æŸ“ã€æ ·å¼å¤„ç†ç­‰
- ç»„ä»¶ï¼šå‡½æ•°ç»„ä»¶ã€ç»„ä»¶é€šè®¯
- è·¯ç”±
- React å¼€å‘ç†å¿µï¼š`å•å‘æ•°æ®æµ`ã€`çŠ¶æ€æå‡` ç­‰
- è§£å†³é—®é¢˜çš„æ€è·¯ã€æŠ€å·§ã€å¸¸è§é”™è¯¯çš„åˆ†æç­‰ä¸Š



## hooksæ¸è¿›ç­–ç•¥

**ç›®æ ‡**ï¼šèƒ½å¤Ÿç†è§£åœ¨reactä¸­ä»€ä¹ˆåœºæ™¯åº”è¯¥ä½¿ç”¨hooks

**å†…å®¹**ï¼š

+ reactæ²¡æœ‰è®¡åˆ’ä»Reactä¸­ç§»é™¤ class [æ–‡æ¡£](https://zh-hans.reactjs.org/docs/hooks-intro.html)
+ Hooks å’Œç°æœ‰ä»£ç å¯ä»¥åŒæ—¶å·¥ä½œï¼Œä½ å¯ä»¥æ¸è¿›å¼åœ°ä½¿ç”¨ä»–ä»¬
  + ä¸æ¨èç›´æ¥ä½¿ç”¨ Hooks å¤§è§„æ¨¡é‡æ„ç°æœ‰ç»„ä»¶ 
  + æ¨èï¼šæ–°åŠŸèƒ½ç”¨ Hooksï¼Œå¤æ‚åŠŸèƒ½å®ç°ä¸äº†çš„ï¼Œä¹Ÿå¯ä»¥ç»§ç»­ç”¨ class
  + æ‰¾ä¸€ä¸ªåŠŸèƒ½ç®€å•ã€éæ ¸å¿ƒåŠŸèƒ½çš„ç»„ä»¶å¼€å§‹ä½¿ç”¨ hooks
+ ä¹‹å‰çš„reactè¯­æ³•å¹¶ä¸æ˜¯ä»¥åå°±ä¸ç”¨äº†
  + class ç»„ä»¶ç›¸å…³çš„ API åœ¨hooksä¸­å¯ä»¥ä¸ç”¨
    + class è‡ªèº«è¯­æ³•ï¼Œæ¯”å¦‚ï¼Œconstructorã€static ç­‰
    + é’©å­å‡½æ•°ï¼Œ`componentDidMount`ã€`componentDidUpdate`ã€`componentWillUnmount`
    + `this` ç›¸å…³çš„ç”¨æ³•
  + **åŸæ¥å­¦ä¹ çš„ React å†…å®¹è¿˜æ˜¯è¦ç”¨çš„**
    + JSXï¼š`{}`ã€`onClick={handleClick}`ã€æ¡ä»¶æ¸²æŸ“ã€åˆ—è¡¨æ¸²æŸ“ã€æ ·å¼å¤„ç†ç­‰
    + ç»„ä»¶ï¼šå‡½æ•°ç»„ä»¶ã€ç»„ä»¶é€šè®¯
    + React å¼€å‘ç†å¿µï¼š`å•å‘æ•°æ®æµ`ã€`çŠ¶æ€æå‡` ç­‰
    + è§£å†³é—®é¢˜çš„æ€è·¯ã€æŠ€å·§ã€å¸¸è§é”™è¯¯çš„åˆ†æç­‰

**æ€»ç»“**ï¼š

1. reactæ²¡æœ‰è®¡åˆ’ä»Reactä¸­ç§»é™¤class
2. reactå°†ç»§ç»­ä¸º class ç»„ä»¶æä¾›æ”¯æŒ
3. å¯ä»¥åœ¨é¡¹ç›®ä¸­åŒæ—¶ä½¿ç”¨hookså’Œclass





## çŸ¥è¯†ç‚¹è¡¥å……-ä½¿ç”¨æ•°ç»„è§£æ„ç®€åŒ–

æ¯”å¦‚ï¼Œè¦è·å–æ•°ç»„ä¸­çš„å…ƒç´ ï¼š

1. åŸå§‹æ–¹å¼ï¼šç´¢å¼•è®¿é—®

```js
const arr = ['aaa', 'bbb']

const a = arr[0]  // è·å–ç´¢å¼•ä¸º 0 çš„å…ƒç´ 
const b = arr[1]  // è·å–ç´¢å¼•ä¸º 1 çš„å…ƒç´ 
```

2. ç®€åŒ–æ–¹å¼ï¼šæ•°ç»„è§£æ„
   - ç›¸å½“äºåˆ›å»ºäº†ä¸¤ä¸ªå˜é‡ï¼ˆå¯ä»¥æ˜¯ä»»æ„çš„å˜é‡åç§°ï¼‰åˆ†åˆ«è·å–åˆ°å¯¹åº”ç´¢å¼•çš„æ•°ç»„å…ƒç´ 

```js
const arr = ['aaa', 'bbb']

const [a, b] = arr
// a => arr[0]
// b => arr[1]

const [state, setState] = arr
```





## useState Hook

### useState Hook çš„åŸºæœ¬ä½¿ç”¨

- ä½¿ç”¨åœºæ™¯ï¼šå½“ä½ æƒ³è¦åœ¨**å‡½æ•°ç»„ä»¶ä¸­ï¼Œä½¿ç”¨ç»„ä»¶çŠ¶æ€æ—¶**ï¼Œå°±è¦ä½¿ç”¨ **useState** Hook äº†
- ä½œç”¨ï¼šä¸ºå‡½æ•°ç»„ä»¶æä¾›çŠ¶æ€ï¼ˆstateï¼‰
- ä½¿ç”¨æ­¥éª¤ï¼š
  1. å¯¼å…¥ `useState` å‡½æ•°
  2. è°ƒç”¨ `useState` å‡½æ•°ï¼Œå¹¶ä¼ å…¥çŠ¶æ€çš„åˆå§‹å€¼
  3. ä» `useState` å‡½æ•°çš„è¿”å›å€¼ä¸­ï¼Œæ‹¿åˆ°çŠ¶æ€å’Œä¿®æ”¹çŠ¶æ€çš„å‡½æ•°
  4. åœ¨ JSX ä¸­å±•ç¤ºçŠ¶æ€
  5. åœ¨æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ä¸­è°ƒç”¨ä¿®æ”¹çŠ¶æ€çš„å‡½æ•°ï¼Œæ¥æ›´æ–°çŠ¶æ€

```jsx
import { useState } from 'react'

const Count = () => {
  // è¿”å›å€¼æ˜¯ä¸€ä¸ªæ•°ç»„
  const [count, setCount] = useState(0)

  return (
    <div>
      {/* å±•ç¤ºçŠ¶æ€å€¼ */}
      <h1>useState Hook -> {count}</h1>
      {/* ç‚¹å‡»æŒ‰é’®ï¼Œè®©çŠ¶æ€å€¼ +1 */}
      <button onClick={() => setCount(count + 1)}>+1</button>
    </div>
  )
}


//class å†™æ³•
class Count extends Component {
  state = {
    count: 0,
  };

  handleChangeCount = () => {
    this.setState({
      count: this.state.count + 1,
    });
  };

  render() {
    const { count } = this.state;
    return (
      <div>
        {count}
        <button onClick={this.handleChangeCount}>ç‚¹å‡»æ”¹å˜count</button>
      </div>
    );
  }
}
```

- å‚æ•°ï¼š**çŠ¶æ€åˆå§‹å€¼**ã€‚æ¯”å¦‚ï¼Œä¼ å…¥ 0 è¡¨ç¤ºè¯¥çŠ¶æ€çš„åˆå§‹å€¼ä¸º 0
  - æ³¨æ„ï¼šæ­¤å¤„çš„çŠ¶æ€å¯ä»¥æ˜¯ä»»æ„å€¼ï¼ˆæ¯”å¦‚ï¼Œæ•°å€¼ã€å­—ç¬¦ä¸²ç­‰ï¼‰ï¼Œè€Œ class ç»„ä»¶ä¸­çš„ state å¿…é¡»æ˜¯å¯¹è±¡
- è¿”å›å€¼ï¼šæ•°ç»„ï¼ŒåŒ…å«ä¸¤ä¸ªå€¼ï¼š1 çŠ¶æ€å€¼ï¼ˆstateï¼‰ 2 ä¿®æ”¹è¯¥çŠ¶æ€çš„å‡½æ•°ï¼ˆsetStateï¼‰



### ä½¿ç”¨useStateç»„ä»¶çš„æ›´æ–°è¿‡ç¨‹

å‡½æ•°ç»„ä»¶ä½¿ç”¨ **useState** hook åçš„æ‰§è¡Œè¿‡ç¨‹ï¼Œä»¥åŠçŠ¶æ€å€¼çš„å˜åŒ–ï¼š 

- ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼š
  1. ä»å¤´å¼€å§‹æ‰§è¡Œè¯¥ç»„ä»¶ä¸­çš„ä»£ç é€»è¾‘
  2. è°ƒç”¨ `useState(0)` å°†ä¼ å…¥çš„å‚æ•°ä½œä¸ºçŠ¶æ€åˆå§‹å€¼ï¼Œå³ï¼š0
  3. æ¸²æŸ“ç»„ä»¶ï¼Œæ­¤æ—¶ï¼Œè·å–åˆ°çš„çŠ¶æ€ count å€¼ä¸ºï¼š 0

- ç»„ä»¶ç¬¬äºŒæ¬¡æ¸²æŸ“ï¼š
  1. ç‚¹å‡»æŒ‰é’®ï¼Œè°ƒç”¨ `setCount(count + 1)` ä¿®æ”¹çŠ¶æ€ï¼Œå› ä¸ºçŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œæ‰€ä»¥ï¼Œè¯¥ç»„ä»¶ä¼šé‡æ–°æ¸²æŸ“
  2. ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼Œä¼šå†æ¬¡æ‰§è¡Œè¯¥ç»„ä»¶ä¸­çš„ä»£ç é€»è¾‘
  3. å†æ¬¡è°ƒç”¨ `useState(0)`ï¼Œæ­¤æ—¶ **React å†…éƒ¨ä¼šæ‹¿åˆ°æœ€æ–°çš„çŠ¶æ€å€¼è€Œéåˆå§‹å€¼**ï¼Œæ¯”å¦‚ï¼Œè¯¥æ¡ˆä¾‹ä¸­æœ€æ–°çš„çŠ¶æ€å€¼ä¸º 1
  4. å†æ¬¡æ¸²æŸ“ç»„ä»¶ï¼Œæ­¤æ—¶ï¼Œè·å–åˆ°çš„çŠ¶æ€ count å€¼ä¸ºï¼š1

æ³¨æ„ï¼š**useState çš„åˆå§‹å€¼(å‚æ•°)åªä¼šåœ¨ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶ç”Ÿæ•ˆ**ã€‚ 

ä¹Ÿå°±æ˜¯è¯´ï¼Œä»¥åçš„æ¯æ¬¡æ¸²æŸ“ï¼ŒuseState è·å–åˆ°éƒ½æ˜¯æœ€æ–°çš„çŠ¶æ€å€¼ã€‚React ç»„ä»¶ä¼šè®°ä½æ¯æ¬¡æœ€æ–°çš„çŠ¶æ€å€¼!



### ä¸ºå‡½æ•°ç»„ä»¶æ·»åŠ å¤šä¸ªçŠ¶æ€

é—®é¢˜ï¼šå¦‚æœä¸€ä¸ªå‡½æ•°ç»„ä»¶éœ€è¦å¤šä¸ªçŠ¶æ€ï¼Œè¯¥å¦‚ä½•å¤„ç†?
å›ç­”ï¼šè°ƒç”¨ `useState` Hook å¤šæ¬¡å³å¯ï¼Œæ¯è°ƒç”¨ä¸€æ¬¡ useState Hook å¯ä»¥æä¾›ä¸€ä¸ªçŠ¶æ€ã€‚
æ³¨æ„ï¼šuseState Hook å¤šæ¬¡è°ƒç”¨è¿”å›çš„ [state, setState] ç›¸äº’ä¹‹é—´ï¼Œäº’ä¸å½±å“ã€‚



- ä½¿ç”¨æ•°ç»„è§£æ„ç®€åŒ– `useState` çš„ä½¿ç”¨
  - çº¦å®šï¼š**ä¿®æ”¹çŠ¶æ€çš„å‡½æ•°åç§°ä»¥ set å¼€å¤´ï¼Œåé¢è·Ÿä¸ŠçŠ¶æ€çš„åç§°**

```js
// è§£æ„å‡ºæ¥çš„åç§°å¯ä»¥æ˜¯ä»»æ„åç§°

const [state, setState] = useState(0)
const [age, setAge] = useState(0)
const [count, setCount] = useState(0)
```





### çŠ¶æ€çš„è¯»å–å’Œä¿®æ”¹

çŠ¶æ€çš„ä½¿ç”¨ï¼š1 è¯»å–çŠ¶æ€ 2 ä¿®æ”¹çŠ¶æ€

1. è¯»å–çŠ¶æ€ï¼šè¯¥æ–¹å¼æä¾›çš„çŠ¶æ€ï¼Œæ˜¯å‡½æ•°å†…éƒ¨çš„å±€éƒ¨å˜é‡ï¼Œå¯ä»¥åœ¨å‡½æ•°å†…çš„ä»»æ„ä½ç½®ä½¿ç”¨

2. ä¿®æ”¹çŠ¶æ€ï¼š
  - `setCount(newValue)` æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå‚æ•°è¡¨ç¤ºï¼š**æ–°çš„çŠ¶æ€å€¼**
  - è°ƒç”¨è¯¥å‡½æ•°åï¼Œå°†**ä½¿ç”¨æ–°çš„çŠ¶æ€å€¼`æ›¿æ¢`æ—§å€¼**
  - ä¿®æ”¹çŠ¶æ€åï¼Œå› ä¸ºçŠ¶æ€å‘ç”Ÿäº†æ”¹å˜ï¼Œæ‰€ä»¥ï¼Œè¯¥ç»„ä»¶ä¼šé‡æ–°æ¸²æŸ“











### hooks çš„ä½¿ç”¨è§„åˆ™

æ³¨æ„ï¼š**React Hooks åªèƒ½ç›´æ¥å‡ºç°åœ¨ å‡½æ•°ç»„ä»¶ ä¸­ï¼Œä¸èƒ½åµŒå¥—åœ¨ if/for/å…¶ä»–æ™®é€šå‡½æ•°ä¸­**ï¼

å¦åˆ™å°±ä¼šæŠ¥é”™ï¼šReact Hook "useState" is called conditionally. React Hooks must be called in the exact same order in every component render

React çš„ useState è¿™ä¸ª Hook è¢«æ¡ä»¶æ€§ï¼ˆæ”¾åœ¨ä¸€ä¸ªæ¡ä»¶åˆ¤æ–­ä¸­ï¼‰çš„è°ƒç”¨äº†ã€‚

React Hooks å¿…é¡»è¦æ¯æ¬¡ç»„ä»¶æ¸²æŸ“æ—¶ï¼ŒæŒ‰ç…§**ç›¸åŒçš„é¡ºåº**æ¥è°ƒç”¨æ‰€æœ‰çš„ Hooksã€‚

- ä¸ºä»€ä¹ˆä¼šæœ‰è¿™æ ·çš„è§„åˆ™ï¼Ÿ å› ä¸º React æ˜¯æŒ‰ç…§ Hooks çš„è°ƒç”¨é¡ºåºæ¥è¯†åˆ«æ¯ä¸€ä¸ª Hookï¼Œå¦‚æœæ¯æ¬¡è°ƒç”¨çš„é¡ºåºä¸åŒï¼Œå¯¼è‡´ React æ— æ³•çŸ¥é“æ˜¯å“ªä¸€ä¸ª Hook

ä¸‰ä¸ªé™åˆ¶æ€»ç»“ï¼š

1. ä¸èƒ½åœ¨if elseè¯­å¥ä¸­ä½¿ç”¨hooks
2. ä¸èƒ½åœ¨forè¯­å¥ä¸­ä½¿ç”¨hooks
3. ä¸èƒ½åœ¨æ™®é€šå‡½æ•°ä¸­ä½¿ç”¨hooks



ä»€ä¹ˆæ˜¯Reactä¸­çš„ç‰¹æ®Šå‡½æ•°ï¼š

1. å‡½æ•°å¼ç»„ä»·
2. useXxxå‘½åçš„è‡ªå®šä¹‰hookså‡½æ•°



### å—æ§ç»„ä»¶-hooks

1. stateæ§åˆ¶valueæˆ–è€…checked
2. onChange å’ŒsetState





## useEffect Hook 

1. side effect - å‰¯ä½œç”¨
2. useEffect çš„åŸºæœ¬ä½¿ç”¨
3. useEffect çš„ä¾èµ–
4. useEffect å‘é€è¯·æ±‚

### side effect - å‰¯ä½œç”¨

ä½¿ç”¨åœºæ™¯ï¼šå½“ä½ æƒ³è¦åœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œ**å¤„ç†å‰¯ä½œç”¨ï¼ˆside effectï¼‰æ—¶**ï¼Œå°±è¦ä½¿ç”¨ **useEffect** Hook äº†
ä½œç”¨ï¼š**å¤„ç†å‡½æ•°ç»„ä»¶ä¸­çš„å‰¯ä½œç”¨ï¼ˆside effectï¼‰**

é—®é¢˜ï¼šå‰¯ä½œç”¨ï¼ˆside effectï¼‰æ˜¯ä»€ä¹ˆ? 
å›ç­”ï¼šåœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•°æˆ–å…¶ä»–æ“ä½œä¿®æ”¹äº†å…¶å±€éƒ¨ç¯å¢ƒä¹‹å¤–çš„çŠ¶æ€å˜é‡å€¼ï¼Œé‚£ä¹ˆå®ƒå°±è¢«ç§°ä¸ºæœ‰å‰¯ä½œç”¨
ç±»æ¯”ï¼Œå¯¹äº 999 æ„Ÿå†’çµæ„Ÿå†’è¯æ¥è¯´ï¼š

- ï¼ˆ**ä¸»**ï¼‰ä½œç”¨ï¼šç”¨äºæ„Ÿå†’å¼•èµ·çš„å¤´ç—›ï¼Œå‘çƒ­ï¼Œé¼»å¡ï¼Œæµæ¶•ï¼Œå’½ç—›ç­‰ 
- å‰¯ä½œç”¨ï¼šå¯è§å›°å€¦ã€å—œç¡ã€å£æ¸´ã€è™šå¼±æ„Ÿ

ç†è§£ï¼šå‰¯ä½œç”¨æ˜¯ç›¸å¯¹äºä¸»ä½œç”¨æ¥è¯´çš„ï¼Œä¸€ä¸ªåŠŸèƒ½ï¼ˆæ¯”å¦‚ï¼Œå‡½æ•°ï¼‰é™¤äº†ä¸»ä½œç”¨ï¼Œå…¶ä»–çš„ä½œç”¨å°±æ˜¯å‰¯ä½œç”¨
å¯¹äº React ç»„ä»¶æ¥è¯´ï¼Œ**ä¸»ä½œç”¨å°±æ˜¯æ ¹æ®æ•°æ®ï¼ˆstate/propsï¼‰æ¸²æŸ“ UI**ï¼Œé™¤æ­¤ä¹‹å¤–éƒ½æ˜¯å‰¯ä½œç”¨ï¼ˆæ¯”å¦‚ï¼Œæ‰‹åŠ¨ä¿®æ”¹ DOMï¼‰

React ç»„ä»¶çš„å…¬å¼ï¼š**UI = f(state)**

å¸¸è§çš„å‰¯ä½œç”¨ï¼ˆside effectï¼‰

- æ•°æ®ï¼ˆAjaxï¼‰è¯·æ±‚ã€æ‰‹åŠ¨ä¿®æ”¹ DOMã€localStorage æ“ä½œç­‰

```js
// ä¸å¸¦å‰¯ä½œç”¨çš„æƒ…å†µï¼š
// è¯¥å‡½æ•°çš„ï¼ˆä¸»ï¼‰ä½œç”¨ï¼šè®¡ç®—ä¸¤ä¸ªæ•°çš„å’Œ
function add(a, b) {
  return a + b
}

// å¸¦å‰¯ä½œç”¨çš„æƒ…å†µï¼š
let c = 1
function add(a, b) {
  // å› ä¸ºæ­¤å¤„ä¿®æ”¹å‡½æ•°å¤–éƒ¨çš„å˜é‡å€¼ï¼Œè€Œè¿™ä¸€ç‚¹ä¸æ˜¯è¯¥å‡½æ•°çš„ä¸»ä½œç”¨ï¼Œå› æ­¤ï¼Œå°±æ˜¯ï¼šside effectï¼ˆå‰¯ä½œç”¨ï¼‰
  c = 2
  return a + b
}

// å¸¦å‰¯ä½œç”¨çš„æƒ…å†µï¼š
function add(a, b) {
  // å› ä¸º console.log ä¼šå¯¼è‡´æ§åˆ¶å°æ‰“å°å†…å®¹ï¼Œæ‰€ä»¥ï¼Œä¹Ÿæ˜¯å¯¹å¤–éƒ¨äº§ç”Ÿå½±å“ï¼Œæ‰€ä»¥ï¼Œä¹Ÿæ˜¯ï¼šå‰¯ä½œç”¨
  console.log(a)
  return a + b
}

// æ²¡æœ‰å‰¯ä½œç”¨ï¼š
function getName(obj) {   // çº¯å‡½æ•°ï¼šå›ºå®šè¾“å…¥ã€å›ºå®šè¾“å‡º
  return obj.name 
}

// æœ‰å‰¯ä½œç”¨ï¼š
function getName(obj) {
  // æ­¤å¤„ç›´æ¥ä¿®æ”¹äº†å‚æ•°çš„å€¼ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå‰¯ä½œç”¨
  obj.name = 'å¤§é£å“¥'
  return obj.name
}
const o = { name: 'å°é©¬å“¥' }
fn(o)
```



### useEffect çš„åŸºæœ¬ä½¿ç”¨  

ä½¿ç”¨åœºæ™¯ï¼šå½“ä½ æƒ³è¦åœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œå¤„ç†å‰¯ä½œç”¨ï¼ˆside effectï¼‰æ—¶ï¼Œå°±è¦ä½¿ç”¨ useEffect Hook äº†

ä½œç”¨ï¼šå¤„ç†å‡½æ•°ç»„ä»¶ä¸­çš„å‰¯ä½œç”¨ï¼ˆside effectï¼‰
æ³¨æ„ï¼šåœ¨å®é™…å¼€å‘ä¸­ï¼Œå‰¯ä½œç”¨æ˜¯ä¸å¯é¿å…çš„ã€‚å› æ­¤ï¼Œreact ä¸“é—¨æä¾›äº† **useEffect** Hook **æ¥å¤„ç†å‡½æ•°ç»„ä»¶ä¸­çš„å‰¯ä½œç”¨**

`useEffect` Hook çœ‹åš `componentDidMount`ï¼Œ`componentDidUpdate` å’Œ `componentWillUnmount` è¿™ä¸‰ä¸ªå‡½æ•°çš„ç»„åˆã€‚

```js
import { useEffect } from 'react'

useEffect(function effect() {
  document.title = `å½“å‰å·²ç‚¹å‡» ${count} æ¬¡`
})

useEffect(() => {
  document.title = `å½“å‰å·²ç‚¹å‡» ${count} æ¬¡`
})
```

è§£é‡Šï¼š

- å‚æ•°ï¼šå›è°ƒå‡½æ•°ï¼ˆç§°ä¸º **effect**ï¼‰ï¼Œå°±æ˜¯**åœ¨è¯¥å‡½æ•°ä¸­å†™å‰¯ä½œç”¨ä»£ç **
- æ‰§è¡Œæ—¶æœºï¼šè¯¥ effect ä¼šåœ¨æ¯æ¬¡ç»„ä»¶æ›´æ–°ï¼ˆDOMæ›´æ–°ï¼‰åæ‰§è¡Œ





### useEffect çš„ä¾èµ–

- é—®é¢˜ï¼šå¦‚æœç»„ä»¶ä¸­æœ‰å¦å¤–ä¸€ä¸ªçŠ¶æ€ï¼Œå¦ä¸€ä¸ªçŠ¶æ€æ›´æ–°æ—¶ï¼Œåˆšåˆšçš„ effect å›è°ƒï¼Œä¹Ÿä¼šæ‰§è¡Œ 

```react
import React, { useEffect, useState } from 'react';

export default function App() {
  const [count, setCount] = useState(0);
  const [msg, setMsg] = useState('');

  //  è°ƒç”¨useEffect  ï¼ˆstateå˜åŒ–æ—¶ï¼ŒuseEffectä¼šè‡ªåŠ¨æ‰§è¡Œï¼‰
  useEffect(() => {
    console.log('userEffectæ‰§è¡Œäº†');
    document.title = count;
  });

  return (
    <div>
      <button onClick={() => setMsg(msg + '!')}>ç‚¹æˆ‘ä¿®æ”¹Msg</button>
      <button onClick={() => setCount(count + 1)}>ç‚¹æˆ‘count+1</button>
    </div>
  );
}
```



- æ€§èƒ½ä¼˜åŒ–ï¼š**è·³è¿‡ä¸å¿…è¦çš„æ‰§è¡Œï¼Œåªåœ¨ count å˜åŒ–æ—¶ï¼Œæ‰æ‰§è¡Œç›¸åº”çš„ effect**

```js
useEffect(() => {
  document.title = `å½“å‰å·²ç‚¹å‡» ${count} æ¬¡`
}, [count])
```

è§£é‡Šï¼š

- ç¬¬äºŒä¸ªå‚æ•°ï¼šå¯é€‰çš„ï¼Œå¯çœç•¥ï¼›ä¹Ÿå¯ä»¥ä¼ ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­çš„å…ƒç´ å¯ä»¥æˆä¸ºä¾èµ–é¡¹ï¼ˆdepsï¼‰ 
- è¯¥ç¤ºä¾‹ä¸­è¡¨ç¤ºï¼šåªæœ‰å½“ count æ”¹å˜æ—¶ï¼Œæ‰ä¼šé‡æ–°æ‰§è¡Œè¯¥ effect



### useEffect çš„ä¾èµ–æ˜¯ä¸€ä¸ªç©ºæ•°ç»„

useEffect çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¿˜å¯ä»¥æ˜¯ä¸€ä¸ª**ç©ºæ•°ç»„ï¼ˆ[]ï¼‰**ï¼Œè¡¨ç¤ºåªåœ¨ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“åæ‰§è¡Œ effect
ä½¿ç”¨åœºæ™¯ï¼š1 äº‹ä»¶ç»‘å®š 2 å‘é€è¯·æ±‚è·å–æ•°æ® ç­‰

```js
useEffect(() => {
  const handleResize = () => {}
  window.addEventListener('resize', handleResize)
}, [])
```

è§£é‡Šï¼š

- è¯¥ effect åªä¼šåœ¨ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“åæ‰§è¡Œï¼Œå› æ­¤ï¼Œå¯ä»¥æ‰§è¡Œåƒäº‹ä»¶ç»‘å®šç­‰åªéœ€è¦æ‰§è¡Œä¸€æ¬¡çš„æ“ä½œ
  - æ­¤æ—¶ï¼Œç›¸å½“äº class ç»„ä»¶çš„ componentDidMount é’©å­å‡½æ•°çš„ä½œç”¨
- è·Ÿ useState Hook ä¸€æ ·ï¼Œä¸€ä¸ªç»„ä»¶ä¸­ä¹Ÿå¯ä»¥è°ƒç”¨ useEffect Hook å¤šæ¬¡ 
- æ¨èï¼šä¸€ä¸ª useEffect åªå¤„ç†ä¸€ä¸ªåŠŸèƒ½ï¼Œæœ‰å¤šä¸ªåŠŸèƒ½æ—¶ï¼Œä½¿ç”¨å¤šæ¬¡ useEffect



### ğŸ””å°ç»“ useEffect ä¸¤ä¸ªå‚æ•°ä½¿ç”¨

- useEffect ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå¿…ä¼ å‚æ•°ã€‚
- useEffect ç¬¬äºŒä¸ªå¯é€‰å‚æ•°ã€‚

```js
// è§¦å‘æ—¶æœºï¼š1 æŒ‚è½½æ—¶æ‰§è¡Œ 2 æ¯æ¬¡ç»„ä»¶é‡æ–°æ¸²æŸ“éƒ½ä¼šå†æ¬¡æ‰§è¡Œï¼ˆä¸å¸¸ç”¨ï¼Œä¼šé€ æˆé¡µé¢å¡é¡¿ï¼‰
useEffect(() => { })

// è§¦å‘æ—¶æœºï¼š1.åªåœ¨æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡  ğŸ˜Š ç­‰åŒäºåœ¨componentDidMountä¸­è°ƒç”¨å›è°ƒå‡½æ•°
useEffect(() => {}, [])

// è§¦å‘æ—¶æœºï¼š1 æŒ‚è½½æ—¶ä¼šæ‰§è¡Œ 2 å½“ count å˜åŒ–æ—¶ä¼šå†æ¬¡æ‰§è¡Œ ğŸ˜Š ç­‰åŒäºåœ¨componentDidMount å’Œ componentDidUpdateä¸¤ä¸ªé’©å­å‡½æ•°ä¸­è°ƒç”¨
// ç±»ä¼¼vueä¸­ä¾¦å¬å™¨ï¼Œå¯ä»¥ç›‘æµ‹æ•°æ®çš„å˜åŒ–ã€‚
useEffect(() => { }, [count])
```



### useEffectå¯ä»¥ç›‘å¬å¤šä¸ªçŠ¶æ€

```react
 // 1ã€ç¬¬ä¸€ç§å†™æ³•ï¼šåˆ†å¼€ç›‘å¬
   useEffect(() => {
     console.log('æ¯æ¬¡æ‹¿åˆ°æœ€æ–°çš„count', count);
   }, [count]);

  useEffect(() => {
     console.log('æ¯æ¬¡æ‹¿åˆ°æœ€æ–°çš„count2', count2);
  }, [count2]);

  // 2. ç¬¬äºŒç§å†™æ³•ï¼šæ•°ç»„å†…å†™å¤šä¸ªå˜é‡
  useEffect(() => {
    console.log('æ¯æ¬¡æ‹¿åˆ°æœ€æ–°çš„count å’Œ count2', count + count2);
  }, [count, count2]);
```











### useEffect ç»„ä»¶å¸è½½æ—¶

é—®é¢˜ï¼šå¦‚ä½•åœ¨ç»„ä»¶å¸è½½æ—¶ï¼Œè§£ç»‘äº‹ä»¶ï¼Ÿæ­¤æ—¶ï¼Œå°±ç”¨åˆ° effect çš„è¿”å›å€¼äº†



é™æ€ç»“æ„ï¼šå¤åˆ¶å³å¯

```react
import React, {  useState } from 'react';

export default function App() {
  // å‡†å¤‡ç»„ä»¶çš„æ˜¾ç¤ºä¸éšè—
  const [isShow, setIsShow] = useState(true);
  return (
    <div>
      {isShow && <Child />}
      <button onClick={() => setIsShow(!isShow)}>ç‚¹å‡»å¸è½½å­ç»„ä»¶</button>
    </div>
  );
}

function Child() {
  // åœ¨å­ç»„ä»¶ä¸­æŒ‚è½½æ—¶ç›‘å¬çª—å£æ”¹å˜äº‹ä»¶
  
  return <div>æˆ‘æ˜¯å­ç»„ä»¶</div>;
}
```



æ­£ç¡®ä»£ç ï¼š

```js
const handleResize = () => {}
useEffect(()=>{
  
  window.addEventListener('resize', handleResize)
},[])

useEffect(() => {
    
   // ç­‰åŒäºåœ¨componentWillUnMounté‡Œè°ƒç”¨è¿”å›å‡½æ•°
  return () => window.removeEventListener('resize', handleResize)  
}, [])
```

è§£é‡Šï¼š

- effect çš„è¿”å›å€¼ä¹Ÿæ˜¯å¯é€‰çš„ï¼Œå¯çœç•¥ã€‚ä¹Ÿå¯ä»¥è¿”å›ä¸€ä¸ªæ¸…ç†å‡½æ•°ï¼Œç”¨æ¥æ‰§è¡Œäº‹ä»¶è§£ç»‘ç­‰æ¸…ç†æ“ä½œ

- æ¸…ç†å‡½æ•°çš„æ‰§è¡Œæ—¶æœºï¼š

  - 1ã€ç©ºæ•°ç»„æ²¡æœ‰ä¾èµ–ã€‘ç»„ä»¶å¸è½½æ—¶

    - æ­¤æ—¶ï¼Œç›¸å½“äº class ç»„ä»¶çš„ componentWillUnmount é’©å­å‡½æ•°çš„ä½œç”¨

  -  2 ã€æœ‰ä¾èµ–é¡¹ã€‘effect é‡æ–°æ‰§è¡Œå‰ï¼ˆæš‚æ—¶çŸ¥é“å³å¯ï¼‰ 

    

- æ¨èï¼šä¸€ä¸ª useEffect åªå¤„ç†ä¸€ä¸ªåŠŸèƒ½ï¼Œæœ‰å¤šä¸ªåŠŸèƒ½æ—¶ï¼Œä½¿ç”¨å¤šæ¬¡ useEffect 

- ä¼˜åŠ¿ï¼š

  - æ ¹æ®ä¸šåŠ¡é€»è¾‘æ¥æ‹†åˆ†ï¼Œç›¸åŒåŠŸèƒ½çš„ä¸šåŠ¡é€»è¾‘æ”¾åœ¨ä¸€èµ·ï¼Œè€Œä¸æ˜¯æ ¹æ®ç”Ÿå‘½å‘¨æœŸæ–¹æ³•åç§°æ¥æ‹†åˆ†ä»£ç  
  - ç¼–å†™ä»£ç æ—¶ï¼Œå…³æ³¨ç‚¹é›†ä¸­ï¼›è€Œä¸æ˜¯ä¸Šä¸‹ç¿»æ»šæ¥æŸ¥çœ‹ä»£ç 

### useEffect æŒ‚è½½å’Œå¸è½½æ¸…ç†ç»¼åˆå†™æ³•

```js
  useEffect(() => {
    const timerId = window.setTimeout(() => {
      console.log('ä¸€ç§’æ—¶é—´åˆ°ï¼Œçˆ†ç‚¸')
    }, 1000)

    return () => {
      window.clearTimeout(timerId)
    }
  }, [])


  useEffect(() => {
    const fn = () => {
      console.log('æµè§ˆå™¨çª—å£è¢«è°ƒæ•´äº†')
    }
    window.addEventListener('resize', fn)

    return () => {
      window.removeEventListener('resize', fn)
    }
  }, [])
```

### useEffect  å‘é€è¯·æ±‚

å‡†å¤‡å·¥ä½œï¼š

1. å®‰è£…`axios`ã€‚
2. å‡†å¤‡`utils/request.js` 
3. å¯èƒ½éœ€è¦é‡å¯é¡¹ç›®ã€‚



åœ¨ç»„ä»¶ä¸­ï¼Œä½¿ç”¨ useEffect Hook å‘é€è¯·æ±‚è·å–æ•°æ®ï¼ˆside effectï¼‰ï¼š

```js
// âœ…æ­£ç¡®å†™æ³•
useEffect(() => {
  const loadData = async () => {
  	await ...
  
  }
  loadData()
}, [])

// âŒé”™è¯¯æ¼”ç¤ºï¼š
// ä¸è¦ç»™ useEffect ç¬¬ä¸€çº§å‡½æ•°æ·»åŠ  async
useEffect(async () => {}, [])
```

è§£é‡Šï¼š

- æ³¨æ„ï¼š**useEffect åªèƒ½æ˜¯ä¸€ä¸ªåŒæ­¥å‡½æ•°ï¼Œä¸èƒ½ä½¿ç”¨ async**
- å› ä¸º effect çš„è¿”å›å€¼åº”è¯¥æ˜¯ä¸€ä¸ªæ¸…ç†å‡½æ•°ï¼ŒReact ä¼šåœ¨ç»„ä»¶å¸è½½æˆ–è€… effect çš„ä¾èµ–é¡¹å˜åŒ–æ—¶é‡æ–°æ‰§è¡Œ 
- ä½†å¦‚æœ effect æ˜¯ async çš„ï¼Œæ­¤æ—¶è¿”å›å€¼æ˜¯ Promise å¯¹è±¡ã€‚è¿™æ ·çš„è¯ï¼Œå°±æ— æ³•ä¿è¯æ¸…ç†å‡½æ•°è¢«ç«‹å³è°ƒç”¨
- å¦‚æœå»¶è¿Ÿè°ƒç”¨æ¸…ç†å‡½æ•°ï¼Œä¹Ÿå°±æ²¡æœ‰æœºä¼šå¿½ç•¥è¿‡æ—¶çš„è¯·æ±‚ç»“æœæˆ–å–æ¶ˆè¯·æ±‚
- **ä¸ºäº†ä½¿ç”¨ async/await è¯­æ³•ï¼Œå¯ä»¥åœ¨ useEffect å†…éƒ¨æˆ–å¤–éƒ¨åˆ›å»º async å‡½æ•°ï¼Œå¹¶è°ƒç”¨**



## Todoæ¡ˆä¾‹-hooksç‰ˆ

1. æ‹†åˆ†å‡½æ•°å¼ç»„ä»¶
2. åˆ—è¡¨æ•°æ®å®šä¹‰å’Œæ¸²æŸ“
3. æ ¹æ®idåˆ é™¤ä¸€æ¡æ•°æ®
4. æ ¹æ®idæ›´æ–°å®ŒæˆçŠ¶æ€isDone
5. æ¸…é™¤å·²å®Œæˆ
6. ç»Ÿè®¡å‰©ä½™æœªå®Œæˆçš„æ•°é‡
7. åˆ‡æ¢æŒ‰é’®ç‚¹å‡»é«˜äº®
8. åˆ‡æ¢æŒ‰é’®ç‚¹å‡»æ˜¾ç¤ºä¸åŒçš„æ•°æ®
9. å—æ§ç»„ä»¶å’Œæ–°å¢æ•°æ®
10. å°é€‰å½±å“å…¨é€‰
11. å…¨é€‰å½±å“å°é€‰
11. æ•°æ®ç¼“å­˜







### useEffect è¸©å‘æ³¨æ„

1. useEffect ç¬¬äºŒä¸ªå‚æ•°ï¼Œéœ€è¦å…ˆå£°æ˜ä¾èµ–æ•°æ®ã€‚

```js
export default function App() {
  // âŒé”™è¯¯å†™æ³•ï¼Œtype å’Œ list è¿˜æ²¡åˆ›å»ºï¼Œæ— æ³•ä½¿ç”¨
  useEffect(() => {
    console.log('æ•°æ®æ›´æ–°æ—¶ - è®¾ç½®æœ¬åœ°å­˜å‚¨æ•°æ®')
  }, [list, type])  
  const [list, setList] = useState([])
  const [type, setType] = useState('all')
```

2. ä¹¦å†™å¤šä¸ª useEffect æ—¶ï¼Œæ³¨æ„å…ˆåä¹¦å†™é¡ºåºã€‚(å…ˆä¹¦å†™ç»„ä»¶æŒ‚è½½æ—¶ï¼Œå†ä¹¦å†™ç»„ä»¶æ›´æ–°æ—¶)

```js
  // æ•°æ®æ›´æ–°æ—¶ - è®¾ç½®æœ¬åœ°å­˜å‚¨æ•°æ®
  useEffect(() => {
    localStorage.setItem('todos', JSON.stringify(list))
    localStorage.setItem('todos-type', type)
  }, [list, type])

  // âŒé”™è¯¯å†™æ³•ï¼šç»„ä»¶æŒ‚è½½æ—¶åº”è¯¥è¦å†™åœ¨æ›´æ–°æ—¶å‰é¢ã€‚
  useEffect(() => {
    const list = JSON.parse(localStorage.getItem('todos')) || []
    const type = localStorage.getItem('todos-type') || 'all'
    setList(list)
    setType(type)
  }, [])
```

